{% extends "base.html" %}
{% block content %}

<script type="text/javascript" src="{{ url_for('static', filename='sortable/Sortable.js') }}"></script>
<script type="text/javascript">
	function updateBallot() {
		// Gets the current sort order of the elements and updates the hidden form field.
		var ballot = document.getElementById('votes').getElementsByTagName('div');
		var list = [];
		for (var i = 0; i < ballot.length; i += 1) {
			list.push(ballot[i].textContent);
		}
		document.getElementById('ballot').value = list.join('|');

		// Adjusts the size of the field for ease of dragging.
		document.getElementById('votes').style.minHeight = document.getElementById('options').clientHeight;
	}

	var options = document.getElementById('options');
	Sortable.create(options, {
		group: 'columns',
		delay: 50,
	});

	var votes = document.getElementById('votes');
	Sortable.create(votes, {
		group: 'columns',
		onSort: function (evt) { updateBallot(); },
		delay: 50,
	});

	// Trigger the update manually on page load so that the starting ballot is loaded in.
	updateBallot();
</script>

{% if info %}
<div class="info">
	<a class="button" href="javascript:$('#info').toggle()">Instructions</a>
	<div id="info">
		{{ info | safe }}
	</div>
</div>
{% endif %}

<div class="sortable-container">
	<h2>Options</h2>
	<div id="options" class="sortable-list">
		{% for item in options %}
        <div class="sortable-item{{ ' premium' if item.premium else '' }}{{ ' new' if item.new else '' }}">
            {{ item.name }}
            {% if item.category %}
            ({{ item.category }})
            {% endif %}
        </div>
		{% endfor %}
	</div>
</div>

<div class="sortable-container">
	<h2>Ballot</h2>
	<div id="votes" class="sortable-list">
		{% for item in votes %}
		<div class="sortable-item{{ ' premium' if item.premium else '' }}{{ ' new' if item.new else '' }}">
            {{ item.name }}
            {% if item.category %}
            ({{ item.category }})
            {% endif %}
        </div>
		{% endfor %}
	</div>
	<div class="form">
		<form method="POST" id="form">
			{{ form.hidden_tag() }}
			<input type="submit" />
		</form>
	</div>
</div>

{% if voters %}
<div class="voter-container">
	<h2>Ballots Cast</h2>
	<div class="voter-list">
		{% for v in voters %}
		<div class="sortable-item center">{{ v.name }}</div>
		{% endfor %}
	</div>
</div>
{% endif %}

{% endblock %}
